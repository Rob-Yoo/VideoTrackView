## 비디오 트랙뷰 구현 과제

<br/>

### 📋 구현 기능

- 번들로부터 가져온 10개의 비디오를 순서대로 트랙뷰에 배치
  - 각각의 비디오에서 5초씩 분할된 썸네일을 추출하여 트랙뷰에 표현
  - 각 비디오의 영상 길이 표시
  
- 수평 스크롤 시 PlayHead가 가리키고 있는 시간대의 비디오 썸네일 표현

- 드래그 앤 드롭으로 영상의 순서 변경
  - PlayHead가 가리키는 비디오가 변경되면 즉시 반영

- 편집 정보(비디오 트랙 순서) 저장
  - 현재는 비디오 파일 이름으로 구성된 배열을 UserDefaults에 저장하여 해당 기능을 구현
  - 확장자가 다른 경우에는 파일 이름 중복이 가능해지는 이슈 미해결
  - PHPickerViewController를 사용하여 갤러리 링크를 저장하는 방식으로 추후 디벨롭 예정

<br/>

### 🚧 개발 고려 사항

<b>기본 환경 설정</b>

- VICO 앱과 동일하게 세로 모드와 다크 모드 고정

<b> 아키텍처 </b>

- MVC 아키텍처 적용

  - 새로운 기술에 집중하면서 기능 구현을 하기 위해 비교적 간단한 MVC 아키텍처 도입
  - VC에서 View를 분리하여 Controller 역할만 담당
    - VideoTrackLoader 객체로부터 비디오 트랙 리스트를 VC에 주입

<b> AutoLayout 코드 추상화 </b>

- Extension을 통해 AutoLayout 코드를 추상화
- 메서드 체이닝을 통해 가독성을 높힘

<b> AVAssetImageGenerator의 requestedTimeToleranceBefore/After 설정 </b>

- 스크롤한 위치의 시간대에 정확한 비디오 썸네일이 표현되어야 하는 비디오 트랙뷰 특성상 이미지 생성 속도보다 요청 시간에 대한 이미지 정확도가 더 중요하기 때문에 zero로 설정

<br/>

### 🚨 트러블 슈팅

<b> 영상의 duration과 초 분할 썸네일들을 가져오는 비동기 작업에 대한 셀 재사용 문제</b>

- 원인 분석

  - cellForItemAt 메서드에서 비동기 작업을 실행하여 이전 셀의 비동기 작업이 재사용된 셀에 적용됨

- 해결 과정

  - prepareForReuse 메서드에서 비동기 작업을 취소하는 방식으로 해결하려고 시도

  - 재사용 문제는 해결할 수 있었으나 시간이 걸리는 비동기 작업이다보니 유저 인터랙션에 대한 반응성이 좋진 않았음
  
  - 이를 캐시 형태로 해결하려했으나 캐시에 저장되기 전의 반응성은 해결하지 못함

  - <b> 따라서, VICO 앱처럼 VC에 진입하기 전 모든 비디오 트랙들에 대한 duration과 썸네일들을 로드하고 진입하는 방식으로 해결 </b>

<br/>

<b> 트랙뷰 스크롤 이벤트와 썸네일 뷰 업데이트 작업간의 동기화 문제 </b>

> 썸네일 뷰의 이미지 업데이트 속도가 스크롤 속도를 따라오지 못하여 현재 비디오의 썸네일과 이전 비디오의 썸네일들이 겹쳐서 렌더링

<br/>

- 원인 분석
  
  - 스크롤 이벤트가 발생할때마다 썸네일 뷰 업데이트 작업을 요청

  - 해당 작업은 비동기 작업이다보니 스크롤 이벤트가 끝났어도 남아있는 이미지 업데이트 작업이 계속 수행됨

- 해결 과정

  - Throttle 방식을 사용하여 스크롤 이벤트에 대한 썸네일 뷰 업데이트 작업 요청을 지정된 시간으로 제한
